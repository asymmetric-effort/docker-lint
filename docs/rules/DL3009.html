<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>DL3009 : Delete the APT lists after installing packages | docker-lint</title>
<meta name="description" content="After installing packages with `apt-get` or `apt`, remove `/var/lib/apt/lists` in the same layer to keep images small and reduce attack surface.">
</head>
<body>
<h1>DL3009 : Delete the APT lists after installing packages</h1>
<h2>Description</h2>
<p>After installing packages with <code>apt-get</code> or <code>apt</code>, remove <code>/var/lib/apt/lists</code> in the same layer to keep images small and reduce attack surface.</p>
<h2>Goals</h2>
<ul>
<li>Minimize image size by cleaning up package list cache.</li>
<li>Prevent stale package metadata from remaining in the final image.</li>
</ul>
<h2>Specification</h2>
<ol>
<li>Inspect each <code>RUN</code> instruction.</li>
<li>Split the instruction into command segments on shell connectors and lowercase each token.</li>
<li>Track the last segment that performs <code>apt-get install</code> or <code>apt install</code> and the last segment that removes <code>/var/lib/apt/lists</code>.</li>
<li>A cleanup segment deletes <code>/var/lib/apt/lists</code> using <code>rm</code> with <code>-r</code>/<code>-rf</code> (any order) or <code>find</code> with <code>-delete</code>.</li>
<li>If an apt install occurs and no subsequent cleanup segment appears, emit <code>DL3009</code> at the instruction line.</li>
</ol>
<p>(c) 2025 Asymmetric Effort, LLC. <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#99;&#97;&#108;&#100;&#119;&#101;&#108;&#108;&#64;&#97;&#115;&#121;&#109;&#109;&#101;&#116;&#114;&#105;&#99;&#45;&#101;&#102;&#102;&#111;&#114;&#116;&#46;&#99;&#111;&#109;">&#115;&#99;&#97;&#108;&#100;&#119;&#101;&#108;&#108;&#64;&#97;&#115;&#121;&#109;&#109;&#101;&#116;&#114;&#105;&#99;&#45;&#101;&#102;&#102;&#111;&#114;&#116;&#46;&#99;&#111;&#109;</a>
<a href="https://asymmetric-effort.com/"><img src="../img/asymmetric-effort.png" alt="Asymmetric Effort logo" width="60" height="60"></a></p>
</body>
</html>
